<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
<link href="css/style.css" media="all" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="lib/embr/src/lib/require.js"></script>
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">

window.addEventListener("load", function(){
    require([ "main" ]);
});

</script>
<script type="text/javascript">

var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-28077326-1']);
_gaq.push(['_trackPageview']);

(function(){
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

</script>
</head>
<body>
    <div id="left">
        <canvas id="gl-canvas" class="grabbable"></canvas>
<textarea id="code" class="shut" style="visibility:hidden" spellcheck="false">
uniform sampler2D texture;
uniform float scale, aspect, time;
uniform mat3 transform;

varying vec2 v_texcoord;

#define PI   3.141592653589793
#define PI_2 1.570796326794897

void main(){
    vec2 rads = vec2(PI * 2., PI);
    float x = (v_texcoord.x - .5) * scale;
    float y = (v_texcoord.y - .5) * scale * aspect;

    // Project to Sphere
    vec3 sphere_pnt = vec3(
        (2. * x) / (1. + x*x + y*y),
        (2. * y) / (1. + x*x + y*y),
        (x*x + y*y - 1.) / (1. + x*x + y*y)
    );
    sphere_pnt *= transform;

    // Convert to Spherical Coordinates
    float r = length(sphere_pnt);
    float lon = atan(sphere_pnt.y, sphere_pnt.x);
    float lat = acos(sphere_pnt.z / r);

    gl_FragColor = texture2D(texture, vec2(lon, lat) / rads);
}
</textarea>
        <svg id="code-toggle" title="Toggle Shader Source" class="shut" width="30" height="30" version="1.2" xmlns="http://www.w3.org/2000/svg">
            <g transform="translate(15,15)">
                <circle cx="0" cy="0" r="13"/>
                <path d="M -7,0 L 7,0 M 0,-7 L 0,7"/>
            </g>
        </svg>
        <div id="panoui">
            <a id="above" href="#">above</a>
            <a id="below" href="#">below</a>
            <a id="fullwindow" class="r" href="#">fullwindow</a>
            <a id="about-toggle" class="r" href="#">about</a>
        </div>
    </div>
    <div id="right">
        <div id="map"></div>
        <div id="mapui">
            <div class="input-border">
                <input id="location" type="text" value="hello" tabindex="0" spellcheck="false"
                    onfocus="this.parentNode.classList.add('focus')"
                    onblur="this.parentNode.classList.remove('focus')"/>
            </div>
        </div>
    </div>
    <div id="about-backdrop" style="visibility:hidden;"></div>
    <div id="about" style="visibility:hidden;">
        <h1>Streetview<br/>Stereographic</h1>
        <p>Shader Toy + Google Map + Panoramic Explorer</p>
        <ul>
            <li>Walk &nbsp; .-. Keyboard &uarr; &larr; &darr; &rarr;</li>
            <li>Rotate .-. Click and drag left panel</li>
        </ul>
        <div id="forkme">
            <a href="http://github.com/notlion/streetview-stereographic">
                <img src="https://a248.e.akamai.net/assets.github.com/img/7afbc8b248c68eb468279e8c17986ad46549fb71/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub">
            </a>
        </div>
    </div>
</body>
</html>
